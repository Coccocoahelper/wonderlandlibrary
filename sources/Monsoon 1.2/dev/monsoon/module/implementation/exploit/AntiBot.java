package dev.monsoon.module.implementation.exploit;

import dev.monsoon.util.misc.ServerUtil;
import org.lwjgl.input.Keyboard;

import dev.monsoon.event.Event;
import dev.monsoon.event.listeners.EventPacket;
import dev.monsoon.event.listeners.EventUpdate;
import dev.monsoon.module.base.Module;
import dev.monsoon.module.setting.impl.ModeSetting;
import net.minecraft.entity.Entity;
import net.minecraft.entity.EntityLivingBase;
import net.minecraft.network.play.server.S0CPacketSpawnPlayer;
import dev.monsoon.module.enums.Category;

public class AntiBot extends Module {
	
public static EntityLivingBase target = null;
	
	private ModeSetting AntibotMode = new ModeSetting("Antibot Mode", this, "Advanced", "Advanced");

	public AntiBot() {
		super("AntiBot", Keyboard.KEY_NONE, Category.EXPLOIT);
	}
	
	public void onEvent(Event e) {
		if (e instanceof EventPacket) {
			if(ServerUtil.isMineplex()) {
				if(((EventPacket<?>) e).getPacket() instanceof S0CPacketSpawnPlayer) {
					S0CPacketSpawnPlayer packet = (S0CPacketSpawnPlayer) ((EventPacket<?>) e).getPacket();
					double posX = packet.func_148942_f() / 32D;
					double posY = packet.func_148949_g() / 32D;
					double posZ = packet.func_148946_h() / 32D;

					double diffX = mc.thePlayer.posX - posX;
					double diffY = mc.thePlayer.posY - posY;
					double diffZ = mc.thePlayer.posZ - posZ;

					double dist = Math.sqrt(diffX * diffX + diffY * diffY + diffZ * diffZ);

					if(dist <= 17D && posX != mc.thePlayer.posX && posY != mc.thePlayer.posY && posZ != mc.thePlayer.posZ)
						e.setCancelled(true);
					//NotificationManager.show(new Notification(NotificationType.WARNING, "AntiBot", "An entity was removed from your game. For suspicion of being a bot.", 1));
				}
			}
		}
		
		if (e instanceof EventUpdate) {
			
			if (e.isPre() && AntibotMode.is("Advanced") && !mc.isSingleplayer() && !(mc.getCurrentServerData().serverIP.toLowerCase().contains("hypixel"))) {
				
				for (Object entity : mc.theWorld.loadedEntityList) {
					
					if (((Entity)entity).isInvisible() && entity != mc.thePlayer) {

						mc.theWorld.removeEntity(((Entity)entity));
						//NotificationManager.show(new Notification(NotificationType.WARNING, "AntiBot", ((Entity) entity).getName() + EnumChatFormatting.RESET + " was removed from your game. For suspicion of being a bot.", 1));
						
					}
					
				}
				
			}

			if(ServerUtil.isMineplex()) {
				for (Object entity : mc.theWorld.loadedEntityList) {

					if (((Entity)entity).isAirBorne && ((Entity) entity).posY > mc.thePlayer.posY + 2) {

						mc.theWorld.removeEntity(((Entity)entity));
						//NotificationManager.show(new Notification(NotificationType.WARNING, "AntiBot", ((Entity) entity).getName() + EnumChatFormatting.RESET + " was removed from your game. For suspicion of being a bot.", 1));

					}

				}
			}
			
		}
		
	}

}
