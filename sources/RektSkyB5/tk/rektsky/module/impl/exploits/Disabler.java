/*
 * Decompiled with CFR 0.152.
 */
package tk.rektsky.module.impl.exploits;

import java.util.ArrayDeque;
import java.util.Queue;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C00PacketKeepAlive;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.server.S01PacketJoinGame;
import net.minecraft.network.play.server.S07PacketRespawn;
import net.minecraft.util.Vec3;
import org.greenrobot.eventbus.Subscribe;
import tk.rektsky.Client;
import tk.rektsky.event.impl.ClientTickEvent;
import tk.rektsky.event.impl.HLPacketSentEvent;
import tk.rektsky.event.impl.PacketReceiveEvent;
import tk.rektsky.event.impl.PacketSentEvent;
import tk.rektsky.event.impl.WorldTickEvent;
import tk.rektsky.module.Category;
import tk.rektsky.module.Module;
import tk.rektsky.module.impl.render.Notification;
import tk.rektsky.module.settings.ListSetting;
import tk.rektsky.utils.Timer;
import tk.rektsky.utils.combat.RotationUtil;
import tk.rektsky.utils.display.ColorUtil;

public class Disabler
extends Module {
    public Vec3 lastReportedPosition = new Vec3(0.0, 0.0, 0.0);
    public int packetCount = 0;
    public int tick = 0;
    public int packets = 0;
    public Queue<Packet<?>> buffer = new ArrayDeque();
    public static String sign = "BBBBBB_0_BBBBBB_0_BBBBBB_0";
    public ListSetting mode = new ListSetting("Mode", new String[]{"Verus", "Verus 1.9 BP", "Verus Combat Only"}, "Verus");
    private Timer timer;
    private Queue<Packet> packetQueue = new ArrayDeque<Packet>();
    private boolean wait;

    public Disabler() {
        super("Disabler", "Keking RektSky since 1995", Category.EXPLOIT);
        String.valueOf("BBBBBB_0_BBBBBB_0_BBBBBB_0");
    }

    @Override
    public void onEnable() {
        this.packets = 0;
        this.tick = 0;
        this.lastReportedPosition = new Vec3(0.0, 0.0, 0.0);
        if (this.mode.getValue().equalsIgnoreCase("verus")) {
            Client.notify(new Notification.PopupMessage("Verus Disabler", "WARNING: The Disabler got semi patched", ColorUtil.NotificationColors.YELLOW, 60));
        }
        this.packetCount = 0;
        this.timer = new Timer();
    }

    @Override
    public void onDisable() {
    }

    @Subscribe
    public void onClientTick(ClientTickEvent event) {
        if (!this.mc.isInGame()) {
            this.buffer.clear();
        }
    }

    @Subscribe
    public void onTick(WorldTickEvent event) {
        double deltaZ;
        double deltaY;
        double deltaX;
        double diff;
        ++this.tick;
        if (this.mode.getValue().equalsIgnoreCase("verus") && this.mc.thePlayer.ticksExisted % 8 == 0 && ((diff = Math.sqrt((deltaX = Math.abs(this.mc.thePlayer.posX - this.lastReportedPosition.xCoord)) * deltaX + (deltaY = Math.abs(this.mc.thePlayer.posY - this.lastReportedPosition.yCoord)) * deltaY + (deltaZ = Math.abs(this.mc.thePlayer.posZ - this.lastReportedPosition.zCoord)) * deltaZ)) > 2.0 || this.tick - this.packets > 200)) {
            this.lastReportedPosition = new Vec3(this.mc.thePlayer.posX, this.mc.thePlayer.posY, this.mc.thePlayer.posZ);
            C03PacketPlayer.C06PacketPlayerPosLook packet = null;
            double y2 = this.mc.thePlayer.posY;
            if (y2 % 1.0 > 0.25) {
                y2 = (int)this.mc.thePlayer.posY + 1;
            }
            packet = RotationUtil.isRotating() ? new C03PacketPlayer.C06PacketPlayerPosLook(this.mc.thePlayer.posX, y2, this.mc.thePlayer.posZ, RotationUtil.getYaw(), RotationUtil.getPitch(), true) : new C03PacketPlayer.C06PacketPlayerPosLook(this.mc.thePlayer.posX, y2, this.mc.thePlayer.posZ, this.mc.thePlayer.rotationYaw, this.mc.thePlayer.rotationPitch, true);
            this.mc.thePlayer.sendQueue.addToSendQueueSilent(packet);
            this.packets = this.tick;
            ++this.packetCount;
        }
    }

    @Subscribe
    public void onRecieve(PacketSentEvent event) {
    }

    @Subscribe
    public void onPacket(HLPacketSentEvent event) {
        if (this.mode.getValue().equalsIgnoreCase("verus")) {
            if (event.getPacket() instanceof C0FPacketConfirmTransaction || event.getPacket() instanceof C00PacketKeepAlive) {
                event.setCanceled(true);
            }
            if (event.getPacket() instanceof C03PacketPlayer) {
                ((C03PacketPlayer)event.getPacket()).onGround = true;
                event.setCanceled(true);
            }
        }
        if (this.mode.getValue().equalsIgnoreCase("Verus Combat Only") && (event.getPacket() instanceof C0FPacketConfirmTransaction || event.getPacket() instanceof C00PacketKeepAlive)) {
            event.setCanceled(true);
        }
        if (this.mode.getValue().equalsIgnoreCase("Verus 1.9 BP") && event.getPacket() instanceof C08PacketPlayerBlockPlacement) {
            ((C08PacketPlayerBlockPlacement)event.getPacket()).facingX = 0.5f;
            ((C08PacketPlayerBlockPlacement)event.getPacket()).facingY = 0.5f;
            ((C08PacketPlayerBlockPlacement)event.getPacket()).facingZ = 0.5f;
        }
    }

    @Subscribe
    public void onWorldChange(PacketReceiveEvent event) {
        if (event.getPacket() instanceof S07PacketRespawn || event.getPacket() instanceof S01PacketJoinGame) {
            this.packetCount = 0;
        }
    }
}

