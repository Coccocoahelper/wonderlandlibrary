package dev.tenacity.module.impl.exploit;

import dev.tenacity.module.ModuleCategory;
import dev.tenacity.module.Module;
import dev.tenacity.module.impl.combat.KillAuraModule;
import dev.tenacity.event.IEventListener;
import dev.tenacity.event.impl.network.PacketSendEvent;
import dev.tenacity.event.impl.player.MotionEvent;
import dev.tenacity.setting.impl.ModeSetting;
import dev.tenacity.util.network.PacketUtils;
import dev.tenacity.util.misc.TimerUtil;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.util.AxisAlignedBB;

import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

public final class AntiAura extends Module {

    private final ModeSetting mode = new ModeSetting("Mode", "Legit", "Legit", "Rage");

    private final List<Packet<?>> packetsList = new CopyOnWriteArrayList<>();

    private final TimerUtil timer = new TimerUtil();
    private double x,y,z;
    private final IEventListener<MotionEvent> motionEventEventListener = e -> {
        switch (mode.getCurrentMode()){
            case "Legit":
                if(timer.hasTimeElapsed(50, true)){
                    if(!packetsList.isEmpty()) {
                        for (Packet<?> packet : packetsList) {
                            PacketUtils.sendPacketNoEvent(packet);
                            packetsList.remove(packet);
                        }
                    }
                    timer.reset();
                }
                break;
            case "Rage":
                x = mc.thePlayer.posX;
                y = mc.thePlayer.posY;
                z = mc.thePlayer.posZ;
                double yaw = Math.toRadians(mc.thePlayer.rotationYaw);
                double xValue = -Math.sin(yaw) * 2;
                double zValue = Math.cos(yaw) * 2;
                    mc.thePlayer.setPosition(x + xValue,y,z + zValue);
                    if(mc.thePlayer.ticksExisted % 2 == 0) {
                        mc.thePlayer.setPosition(x - xValue, y, z - zValue);
                }
                break;
        }
    };

    private final IEventListener<PacketSendEvent> packetSendEventEventListener = e -> {
        if(e.getPacket() instanceof C03PacketPlayer){
            packetsList.add(e.getPacket());
            e.cancel();
        }
    };

    public AntiAura() {
        super("AntiAura", "can sometimes cause your enemies aura to stop working properly", ModuleCategory.EXPLOIT);
        initializeSettings(mode);
    }
}
