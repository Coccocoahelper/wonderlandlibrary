/* November.lol Â© 2023 */
package lol.november.feature.module.impl.exploit;

import static net.minecraft.network.play.client.C03PacketPlayer.C06PacketPlayerPosLook;

import lol.november.feature.module.Category;
import lol.november.feature.module.Module;
import lol.november.feature.module.Register;
import lol.november.feature.setting.Setting;
import lol.november.listener.bus.Listener;
import lol.november.listener.bus.Subscribe;
import lol.november.listener.event.net.EventPacket;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;

/**
 * @author Gavin
 * @since 2.0.0
 */
@Register(
  name = "Disabler",
  description = "Disables anti-cheats or their checks",
  category = Category.EXPLOIT
)
public class DisablerModule extends Module {

  private final Setting<Mode> mode = new Setting<>("Mode", Mode.BLOCKS_MC);

  private boolean funny = false;

  @Override
  public void disable() {
    super.disable();
    funny = false;
  }

  @Subscribe
  private final Listener<EventPacket.Out> packetOut = event -> {
    switch (mode.getValue()) {
      case WATCHDOG -> {
        // TODO
      }
      case BLOCKS_MC -> {
        if (mc.thePlayer == null || mc.thePlayer.ticksExisted > 120) return;

        if (event.get() instanceof C06PacketPlayerPosLook) {
          if (!funny) {
            event.setCanceled(true);
            funny = true;
          }
        } else if (event.get() instanceof C0FPacketConfirmTransaction packet) {
          packet.setUid(Short.MAX_VALUE);
        }
      }
    }
  };

  private enum Mode {
    WATCHDOG,
    VOID_TP,
    BLOCKS_MC,
  }
}
